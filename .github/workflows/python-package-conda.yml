name: Publish SPLACE in Conda

on:
  release:
    types: [published]

jobs:
  build-and-upload:
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v2

      - name: Download and Install Anaconda
        run: |
          wget https://repo.anaconda.com/archive/Anaconda3-2025.12-2-Linux-x86_64.sh -O ~/anaconda.sh
          bash ~/anaconda.sh -b -p $HOME/anaconda
          echo "$HOME/anaconda/bin" >> $GITHUB_PATH  # Adiciona o Anaconda ao PATH

      - name: Update Conda and Install Conda Build
        run: |
          $HOME/anaconda/bin/conda update -n base -c defaults conda -y
          $HOME/anaconda/bin/conda install -n base -c conda-forge conda-build anaconda-client -y

      - name: Configure Conda Default Channel
        run: |
          $HOME/anaconda/bin/conda config --add channels defaults

      - name: Verify Conda Build Installation
        run: |
          $HOME/anaconda/bin/conda list conda-build  # Verifica se o conda-build est√° instalado

      - name: Build the Conda package using conda-build executable
        env:
          CONDA_NO_PLUGINS: true
        run: |
          $HOME/anaconda/bin/conda-build conda-recipe

      - name: Upload package to Anaconda
        env:
          ANACONDA_API_TOKEN: ${{ secrets.ANACONDA_API_TOKEN }}  # Define o token no ambiente
        run: |
          $HOME/anaconda/bin/anaconda upload --skip-existing $HOME/anaconda/conda-bld/noarch/*.tar.bz2
